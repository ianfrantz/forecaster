---
title: "Forecasting Hierarchical Sales Models"
author: "Ian Frantz (www.ianfrantz.com)"
date: "`r format(Sys.time(), '%Y %M, %D')`"
output:
  html_document:
    theme: united
    highlight: tango
    fig_width: 10
    fig_height: 6
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE)
library(dplyr)
library(purrr)
library(ggplot2)
```

```{r functions, include = FALSE}
#The "Simulator" function is defined here with four variables. 
Simulator <- function(weeks, price, samplesize, probability) {
  output <- c ()
  for (i in 1:weeks)
  {
    simulation <- purrr::pmap(list(x = price, size = samplesize, replace = TRUE,  prob = probability), sample)
    output <- append(output, sum(simulation$price))
  }
  return(output)
}


#The "ProductList" function is used to create lists based on "Product X" and "Tier X" data.frames 
ProductList <- function(product.table, product_name1, tier_name1) {
  dplyr::filter (product.table, product_name1 == product_name, 
          tier_name1 == tier_name) %>% as.list() }

```


# What will be the annual sales results for Drift's Product 1 - Tier 1?
IF:
* Trial 1 - For 52 weeks, Drift makes 1 sale per week.
* Trial 2 - For 1 Quarter, Drift makes 35 sales per week.

```{r product.table, echo=FALSE}
load (file = "../Data/product.table.RData")
knitr::kable(product.table,
             caption = "Hierarchical Pricing Model")
```
```{r create.data, echo=FALSE}
p1t1 <- ProductList(product.table, "Product 1", "Tier 1")
```



```{r visualization, echo=FALSE}
#Simulation tial #1 (52 weeks, 1 sale per week)
y <- Simulator(52, p1t1[4], 1, p1t1[5])
lx <- length(y)
x <- 1:lx

#trial1 results for 1st Simulator with proportional barchart
trial1 <- data.frame(x,y)

productplot1 <- ggplot(data = trial1) +
  geom_bar(aes(x = y, y = ..prop..), fill = "green")

productplot1
```
# ANSWER: 
* For Trial 1 - 
* For Trial 2 -
```{r, echo = FALSE} 
sum(trial1$y)
```


